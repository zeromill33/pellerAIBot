# Story 7.3: 支持按 slug 查询最新状态

## Status
Approved

## Story
**作为** 运营人员，  
**我希望** 通过 `/status <slug>` 查询最近一次报告状态（ready/published/blocked），  
**以便** 及时判断是否需要重试或人工介入。

Epic Context: 对应 Epic 7「数据落地与运营校验」的 E7-S3。  
[Source: prd/epic-plan.md#Epic 7：数据落地与运营校验]

Dependencies: 依赖 StorageAdapter 支持 `getLatestReport(slug)` 与三表落地结果。  
[Source: architecture/architecture-core.md#3.1 Provider 接口清单（概览）]

## Acceptance Criteria
1. 提供 `/status <slug>` 命令，返回最近一次报告状态（ready/published/blocked）与必要信息（如生成时间、validator_code）。  
   [Source: architecture/source-tree.md#1) 源码目录结构（AI Signal Bot）]
2. StorageAdapter 必须实现 `getLatestReport(slug)`，从存储中取回最新 report 记录。  
   [Source: architecture/architecture-core.md#3.1 Provider 接口清单（概览）]
3. 当 slug 不存在时，应返回明确提示（例如“未找到该事件/暂无报告”）。  
   [Source: architecture/coding-standards.md#6.1 统一 AppError]
4. `/status` 输出需遵循 bot 回执格式，并包含可读错误信息（若失败）。  
   [Source: architecture/coding-standards.md#6.3 只在入口层做最终输出]

## Tasks / Subtasks
- [ ] Task 1：实现 `getLatestReport(slug)` 存储查询（AC: 2）  
  [Source: architecture/architecture-core.md#3.1 Provider 接口清单（概览）]
  - [ ] Subtask 1.1：在 `src/storage/sqlite/report.repo.ts` 查询最新 report（按生成时间或 id 排序）
- [ ] Task 2：实现 `/status <slug>` 命令与回执（AC: 1,3,4）  
  [Source: architecture/source-tree.md#1) 源码目录结构（AI Signal Bot）]
  - [ ] Subtask 2.1：在 `src/bot/commands/status.ts` 调用 `triggerStatus/getLatestReport`
  - [ ] Subtask 2.2：在 `src/orchestrator/index.ts` 增加 `triggerStatus` 入口（如尚未实现）
  - [ ] Subtask 2.3：未找到时返回标准化错误
- [ ] Task 3：补充 `/status` 测试（AC: 1-4）  
  [Source: architecture/tech-stack.md#9) 测试策略]
  - [ ] Subtask 3.1：模拟存在 report 与不存在 report 的两种回执

## Dev Notes
### Previous Story Insights
No specific guidance found in architecture docs.  
[Source: architecture/architecture-core.md]

### Data Models
- Report 表字段含 `status`、`validator_code`、`generated_at`。  
  [Source: architecture/architecture-core.md#7.2 数据表（SQLite 逻辑模型）]

### API Specifications
- StorageAdapter：`getLatestReport(slug)`（用于 /status）。  
  [Source: architecture/architecture-core.md#3.1 Provider 接口清单（概览）]

### Component Specifications
- `/status` 作为 bot 命令入口，按统一回执格式输出。  
  [Source: architecture/source-tree.md#1) 源码目录结构（AI Signal Bot）]

### File Locations
- `src/bot/commands/status.ts`：/status 命令实现。  
  [Source: architecture/source-tree.md#1) 源码目录结构（AI Signal Bot）]
- `src/orchestrator/index.ts`：triggerStatus 入口。  
  [Source: architecture/source-tree.md#1) 源码目录结构（AI Signal Bot）]
- `src/storage/sqlite/report.repo.ts`：获取最新 report。  
  [Source: architecture/source-tree.md#1) 源码目录结构（AI Signal Bot）]

### Testing Requirements
- 参考单元/集成测试策略。  
  [Source: architecture/tech-stack.md#9) 测试策略]

### Technical Constraints
- 返回内容不包含敏感配置。  
  [Source: architecture/coding-standards.md#7.2 Secrets 管理]

### Project Structure Notes
- `docs/architecture/unified-project-structure.md` 未找到；使用 `docs/architecture/source-tree.md` 作为目录结构依据。  
  [Source: architecture/source-tree.md#1) 源码目录结构（AI Signal Bot）]

## Change Log
| Date       | Version | Description | Author |
| ---------- | ------- | ----------- | ------ |
| 2026-01-27 | 0.1     | 创建故事草稿 | Bob    |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
